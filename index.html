<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jeropoints - Asamblea Jerovia</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --rosa-principal: #f8bbd0;
    --rosa-fuerte: #e91e63;
    --dorado: #dfaf37; --plata: #9e9e9e; --bronce: #cd7f32;
    /* Arcoíris oficial en tonos pastel: rojo, naranja, amarillo, verde, celeste, azul, lila */
    --arcoiris-oficial: linear-gradient(90deg, #ffadad, #ffd6a5, #fdffb6, #caffbf, #9bf6ff, #a0c4ff, #bdb2ff);
  }

  body { 
    font-family: 'Montserrat', sans-serif; 
    background: #fffafb; 
    color: #444; 
    margin: 0; 
    min-height: 100vh; 
    padding-bottom: 80px; /* Espacio para que los botones de abajo no tapen la lista */
  }
  
  header { 
    background: white; 
    padding: 25px; 
    text-align: center; 
    border-bottom: 4px solid transparent; 
    border-image: var(--arcoiris-oficial) 1;
    box-shadow: 0 4px 15px rgba(0,0,0,0.03);
  }
  
  h1 { font-family: 'Playfair Display', serif; font-size: 2.5rem; color: var(--rosa-fuerte); margin: 0; letter-spacing: 1px; }

  /* Podio */
  .podium-container { display: flex; justify-content: center; align-items: flex-end; gap: 10px; margin: 40px auto; height: 260px; max-width: 600px; padding: 0 15px; }
  .podium-step { flex: 1; display: flex; flex-direction: column; align-items: center; transition: 0.3s; }
  .podium-bar { width: 100%; border-radius: 12px 12px 0 0; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
  
  .step-1 { height: 160px; background: var(--dorado); order: 2; }
  .step-2 { height: 120px; background: var(--plata); order: 1; }
  .step-3 { height: 90px; background: var(--bronce); order: 3; }
  
  .podium-name { font-family: 'Playfair Display', serif; font-weight: bold; margin-bottom: 8px; font-size: 1rem; color: #333; text-align: center; }
  .avatar { width: 65px; height: 65px; border-radius: 50%; background: white; margin-bottom: -10px; z-index: 2; border: 4px solid white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); object-fit: cover; }

  /* Lista */
  .ranking-list { max-width: 650px; margin: 0 auto; padding: 20px; }
  .sister-card { 
    background: white; margin-bottom: 12px; padding: 15px 25px; border-radius: 50px; 
    display: flex; justify-content: space-between; align-items: center; 
    cursor: pointer; transition: all 0.3s ease; border: 1px solid #f0f0f0; 
  }
  .sister-card:hover { transform: translateX(5px); background: var(--rosa-principal); color: white; border-color: var(--rosa-principal); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

  /* Botones Fijos (Esquinas) */
  .btn-fixed {
    position: fixed;
    bottom: 20px;
    padding: 12px 20px;
    border-radius: 30px;
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: 0.3s;
    z-index: 50;
    font-size: 0.85rem;
  }
  .btn-earn {
    left: 20px;
    background: white;
    color: #2e7d32; /* Verde fuerte */
    border: 2px solid #caffbf; /* Verde del arcoiris */
  }
  .btn-earn:hover { background: #caffbf; color: #1b5e20; transform: translateY(-3px); }
  
  .btn-lose {
    right: 20px;
    background: white;
    color: #c62828; /* Rojo fuerte */
    border: 2px solid #ffadad; /* Rojo del arcoiris */
  }
  .btn-lose:hover { background: #ffadad; color: #b71c1c; transform: translateY(-3px); }

  /* Modales */
  .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(233, 30, 99, 0.15); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1000; transition: opacity 0.3s; }
  .modal-content { background: white; padding: 35px; border-radius: 25px; width: 90%; max-width: 380px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.1); position: relative; }
  
  input { width: 100%; padding: 12px; margin: 20px 0; border: 2px solid var(--rosa-principal); border-radius: 12px; text-align: center; box-sizing: border-box; font-family: 'Montserrat', sans-serif; outline: none; }
  .btn-action { background: var(--rosa-fuerte); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: 600; font-family: 'Montserrat', sans-serif; transition: 0.3s; width: 100%; margin-bottom: 10px; }
  .btn-action:hover { opacity: 0.9; }
  
  .close-icon { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; color: #aaa; cursor: pointer; transition: 0.2s; }
  .close-icon:hover { color: var(--rosa-fuerte); }

  /* Tablas internas de los modales */
  .detail-container { max-height: 300px; overflow-y: auto; margin-top: 15px; text-align: left; }
  .detail-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
  .detail-table th { border-bottom: 2px solid var(--rosa-principal); padding: 10px; color: var(--rosa-fuerte); position: sticky; top: 0; background: white; }
  .detail-table td { padding: 10px; border-bottom: 1px solid #f9f9f9; }

  .hidden { display: none !important; }
  .loading-msg { text-align: center; padding: 50px; color: var(--rosa-fuerte); font-weight: 500; }

  @media (max-width: 600px) {
    .btn-fixed { bottom: 10px; padding: 10px 15px; font-size: 0.75rem; }
    .btn-earn { left: 10px; }
    .btn-lose { right: 10px; }
  }
</style>
</head>
<body>

<header>
  <h1>Jeropoints</h1>
</header>

<main id="mainContent">
  <div class="loading-msg">Cargando puntos de la Asamblea... ✨</div>
</main>

<button class="btn-fixed btn-earn" onclick="showRules('earn')">Cómo ganar puntos</button>
<button class="btn-fixed btn-lose" onclick="showRules('lose')">Cómo perder puntos</button>

<div id="rulesModal" class="modal-overlay hidden" onclick="closeModal('rulesModal')">
  <div class="modal-content" style="max-width: 450px;" onclick="event.stopPropagation()">
    <span class="close-icon" onclick="closeModal('rulesModal')">&times;</span>
    <h2 id="rulesTitle" style="font-family: 'Playfair Display', serif; margin: 0 0 15px 0;"></h2>
    <div class="detail-container" id="rulesContent"></div>
  </div>
</div>

<div id="loginModal" class="modal-overlay hidden" onclick="closeModal('loginModal')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="close-icon" onclick="closeModal('loginModal')">&times;</span>
    <h2 id="loginTitle" style="font-family: 'Playfair Display', serif; color: var(--rosa-fuerte); margin: 0;"></h2>
    <p style="font-size: 0.85rem; color: #888;">Ingresa tu clave para ver tus registros</p>
    <input type="password" id="passInput" placeholder="Contraseña">
    <button class="btn-action" onclick="verificarPassword()">Entrar</button>
  </div>
</div>

<div id="historyModal" class="modal-overlay hidden" onclick="closeModal('historyModal')">
  <div class="modal-content" style="max-width: 450px;" onclick="event.stopPropagation()">
    <span class="close-icon" onclick="closeModal('historyModal')">&times;</span>
    <h2 id="historyTitle" style="font-family: 'Playfair Display', serif; color: var(--rosa-fuerte); margin: 0;"></h2>
    <div class="detail-container" id="historyContent"></div>
  </div>
</div>

<script>
// --- DATOS DE REGLAS (Las reincorporé para que los botones funcionen) ---
const reglasGanar = [
  { motivo: "Realizar acto de servicio asignado", puntos: "+10" },
  { motivo: "Destacar en un trabajo", puntos: "+5" },
  { motivo: "Saber de memoria tu parlamento en la pública", puntos: "+50" }
];

const reglasPerder = [
  { motivo: "Faltar a reunión sin aviso", puntos: "-10" },
  { motivo: "No preparar tarea", puntos: "-5" },
  { motivo: "Interrumpir a otra hermana", puntos: "-10" }
];

// --- LÓGICA PRINCIPAL ---
let globalData = [];
let currentSister = null;
const MI_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxxrdvC72xVgNMPweiasl3sADG56G7GX4r9QjmxnGZF8_uVv77HSunh2At8XezTV0lfqQ/exec"; 

async function fetchData() {
  try {
    const resp = await fetch(MI_SCRIPT_URL);
    globalData = await resp.json();
    render();
  } catch (error) {
    console.error("Error:", error);
    document.getElementById('mainContent').innerHTML = "<p style='text-align:center; padding:20px;'>Hubo un problema al cargar los datos. Revisa la URL.</p>";
  }
}

function render() {
  const sorted = [...globalData].sort((a,b) => b.totalPuntos - a.totalPuntos);
  const container = document.getElementById('mainContent');
  
  container.innerHTML = `
    <div class="podium-container" id="podium"></div>
    <div class="ranking-list" id="rankingList"></div>
  `;

  const pod = document.getElementById('podium');
  const order = [1, 0, 2]; 
  pod.innerHTML = order.map(i => {
    const s = sorted[i];
    if(!s) return '<div style="flex:1"></div>';
    return `
      <div class="podium-step">
        <div class="podium-name">${s.nombre}</div>
        <img src="${s.foto || 'https://ui-avatars.com/api/?name='+s.nombre+'&background=f8bbd0&color=fff'}" class="avatar">
        <div class="podium-bar step-${i+1}">
            <span style="font-size:1.3rem">${s.totalPuntos}</span>
            <small style="font-size:0.7rem; opacity:0.8">PTS</small>
        </div>
      </div>`;
  }).join('');

  document.getElementById('rankingList').innerHTML = sorted.map((s, i) => `
    <div class="sister-card" onclick="openLogin('${s.nombre}')">
      <span><strong style="color:var(--rosa-fuerte)">${i+1}.</strong> ${s.nombre}</span>
      <span style="font-weight:bold; font-size:1.1rem; color:var(--rosa-fuerte)">${s.totalPuntos}</span>
    </div>`).join('');
}

// --- FUNCIONES DE MODALES ---
function closeModal(modalId) {
  document.getElementById(modalId).classList.add('hidden');
}

function showRules(tipo) {
  const isEarn = tipo === 'earn';
  const reglas = isEarn ? reglasGanar : reglasPerder;
  const color = isEarn ? '#2e7d32' : '#c62828';
  
  document.getElementById('rulesTitle').innerText = isEarn ? "Cómo ganar puntos" : "Cómo perder puntos";
  document.getElementById('rulesTitle').style.color = color;
  
  let html = `<table class="detail-table"><tbody>`;
  reglas.forEach(r => {
    html += `<tr>
      <td style="font-weight:bold; color:${color}; width: 60px;">${r.puntos}</td>
      <td>${r.motivo}</td>
    </tr>`;
  });
  html += `</tbody></table>`;
  
  document.getElementById('rulesContent').innerHTML = html;
  document.getElementById('rulesModal').classList.remove('hidden');
}

function openLogin(nombre) {
  currentSister = globalData.find(s => s.nombre === nombre);
  document.getElementById('loginTitle').innerText = nombre;
  document.getElementById('passInput').value = "";
  document.getElementById('loginModal').classList.remove('hidden');
}

function verificarPassword() {
  const input = document.getElementById('passInput').value;
  if(String(input) === String(currentSister.password)) {
    closeModal('loginModal');
    showHistory();
  } else {
    alert("Contraseña incorrecta. Intenta de nuevo.");
  }
}

function showHistory() {
  const content = document.getElementById('historyContent');
  if (currentSister.detalles.length === 0) {
    content.innerHTML = "<p style='padding:20px; color:#999; text-align:center;'>Aún no tienes registros.</p>";
  } else {
    let html = `<table class="detail-table"><thead><tr><th>Fecha</th><th>Motivo</th><th>Pts</th></tr></thead><tbody>`;
    [...currentSister.detalles].reverse().forEach(d => {
      let fechaFormateada = "S/F";
      if(d.fecha) {
          const dateObj = new Date(d.fecha);
          fechaFormateada = isNaN(dateObj) ? d.fecha : dateObj.toLocaleDateString('es-ES', {day:'2-digit', month:'2-digit'});
      }
      const colorPts = d.puntos >= 0 ? "green" : "red";
      const signo = d.puntos >= 0 ? "+" : "";
      html += `<tr>
        <td style="color:#888">${fechaFormateada}</td>
        <td>${d.motivo}</td>
        <td style="font-weight:bold; color:${colorPts}">${signo}${d.puntos}</td>
      </tr>`;
    });
    html += `</tbody></table>`;
    content.innerHTML = html;
  }
  document.getElementById('historyTitle').innerText = "Historial de " + currentSister.nombre;
  document.getElementById('historyModal').classList.remove('hidden');
}

// Iniciar
fetchData();
</script>
</body>
</html>
