<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jeropoints - Asamblea Jerovia</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --rosa-principal: #f8bbd0;
    --rosa-fuerte: #e91e63;
    --dorado: #dfaf37; --plata: #9e9e9e; --bronce: #cd7f32;
    /* Arcoíris oficial: rojo, naranja, amarillo, verde, celeste, azul, lila */
    --arcoiris-oficial: linear-gradient(90deg, #ffadad, #ffd6a5, #fdffb6, #caffbf, #9bf6ff, #a0c4ff, #bdb2ff);
  }

  body { 
    font-family: 'Montserrat', sans-serif; 
    background: #fffafb; 
    color: #444; 
    margin: 0; 
    min-height: 100vh; 
    padding-bottom: 100px; 
  }
  
  header { 
    background: white; 
    padding: 25px; 
    text-align: center; 
    border-bottom: 5px solid transparent; 
    border-image: var(--arcoiris-oficial) 1;
    box-shadow: 0 4px 15px rgba(0,0,0,0.03);
  }
  
  h1 { font-family: 'Playfair Display', serif; font-size: 2.5rem; color: var(--rosa-fuerte); margin: 0; letter-spacing: 1px; }

  /* Podio */
  .podium-container { display: flex; justify-content: center; align-items: flex-end; gap: 10px; margin: 40px auto; height: 260px; max-width: 600px; padding: 0 15px; }
  .podium-step { flex: 1; display: flex; flex-direction: column; align-items: center; transition: 0.3s; }
  .podium-bar { width: 100%; border-radius: 12px 12px 0 0; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
  
  .step-1 { height: 160px; background: var(--dorado); order: 2; }
  .step-2 { height: 120px; background: var(--plata); order: 1; }
  .step-3 { height: 90px; background: var(--bronce); order: 3; }
  
  .podium-name { font-family: 'Playfair Display', serif; font-weight: bold; margin-bottom: 8px; font-size: 1rem; color: #333; text-align: center; }
  .avatar { width: 65px; height: 65px; border-radius: 50%; background: white; margin-bottom: -10px; z-index: 2; border: 4px solid white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); object-fit: cover; }

  /* Lista */
  .ranking-list { max-width: 650px; margin: 0 auto; padding: 20px; }
  .sister-card { 
    background: white; margin-bottom: 12px; padding: 15px 25px; border-radius: 50px; 
    display: flex; justify-content: space-between; align-items: center; 
    cursor: pointer; transition: all 0.3s ease; border: 1px solid #f0f0f0; 
  }
  .sister-card:hover { transform: translateX(5px); background: var(--rosa-principal); color: white; border-color: var(--rosa-principal); }

  /* Botones Fijos con colores solicitados */
  .btn-fixed {
    position: fixed; bottom: 25px; padding: 14px 22px; border-radius: 30px;
    font-family: 'Montserrat', sans-serif; font-weight: 700; cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15); transition: 0.3s; z-index: 50; border: none;
  }
  .btn-earn { left: 20px; background: #4caf50; color: white; }
  .btn-earn:hover { background: #388e3c; transform: scale(1.05); }
  
  .btn-lose { right: 20px; background: #f44336; color: white; }
  .btn-lose:hover { background: #d32f2f; transform: scale(1.05); }

  /* Modales Estilizados */
  .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(233, 30, 99, 0.1); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; z-index: 1000; }
  .modal-content { background: white; padding: 35px; border-radius: 30px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.1); position: relative; border: 2px solid var(--rosa-principal); }
  
  input { width: 100%; padding: 14px; margin: 20px 0; border: 2px solid var(--rosa-principal); border-radius: 15px; text-align: center; font-size: 1rem; outline: none; }
  .btn-action { background: var(--rosa-fuerte); color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-weight: 600; width: 100%; font-size: 1rem; }
  
  .close-x { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; color: #ccc; cursor: pointer; }

  .detail-container { max-height: 300px; overflow-y: auto; margin-top: 20px; }
  .detail-table { width: 100%; border-collapse: collapse; }
  .detail-table td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; font-size: 0.9rem; }

  .hidden { display: none !important; }
  .loading { text-align: center; padding: 100px; color: var(--rosa-fuerte); font-size: 1.2rem; }
</style>
</head>
<body>

<header>
  <h1>Jeropoints</h1>
</header>

<main id="mainContent">
  <div class="loading">✨ Abriendo el Libro de Puntos... ✨</div>
</main>

<button class="btn-fixed btn-earn" onclick="openRules('earn')">Cómo ganar puntos</button>
<button class="btn-fixed btn-lose" onclick="openRules('lose')">Cómo perder puntos</button>

<div id="rulesModal" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="close-x" onclick="document.getElementById('rulesModal').classList.add('hidden')">&times;</span>
    <h2 id="rulesTitle" style="font-family: 'Playfair Display', serif;"></h2>
    <div id="rulesList" class="detail-container"></div>
  </div>
</div>

<div id="loginModal" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <h2 id="loginName" style="font-family: 'Playfair Display', serif; color: var(--rosa-fuerte); margin:0;"></h2>
    <p style="color: #888; font-size: 0.8rem;">Introduce tu contraseña secreta</p>
    <input type="password" id="passInput" placeholder="••••••••">
    <button class="btn-action" onclick="checkPass()">Ver mis registros</button>
  </div>
</div>

<div id="historyModal" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
  <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
    <span class="close-x" onclick="document.getElementById('historyModal').classList.add('hidden')">&times;</span>
    <h2 id="histTitle" style="font-family: 'Playfair Display', serif; color: var(--rosa-fuerte);"></h2>
    <div id="histBody" class="detail-container"></div>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwbnRBGyL2Uo84GD6yB9kRwCTCrMMyJk4P9YCxgWKQdXPxwsPe4TlWKN_3Y-dgeNL2yoA/exec";
let sisters = [];
let activeSister = null;

async function init() {
    try {
        const r = await fetch(SCRIPT_URL);
        sisters = await r.json();
        render();
    } catch(e) {
        document.getElementById('mainContent').innerHTML = "<p style='text-align:center; padding:50px;'>Error de conexión. Verifica los permisos del Script.</p>";
    }
}

function render() {
    const sorted = [...sisters].sort((a,b) => b.totalPuntos - a.totalPuntos);
    const main = document.getElementById('mainContent');
    main.innerHTML = `<div class="podium-container" id="pod"></div><div class="ranking-list" id="list"></div>`;
    
    // Podio
    const pod = document.getElementById('pod');
    [1,0,2].forEach(idx => {
        const s = sorted[idx];
        if(!s) return;
        pod.innerHTML += `
            <div class="podium-step">
                <div class="podium-name">${s.nombre}</div>
                <img src="${s.foto || 'https://ui-avatars.com/api/?name='+s.nombre+'&background=f8bbd0&color=fff'}" class="avatar">
                <div class="podium-bar step-${idx+1}"><span>${s.totalPuntos}</span><small>PTS</small></div>
            </div>`;
    });

    // Lista
    const list = document.getElementById('list');
    sorted.forEach((s, i) => {
        list.innerHTML += `
            <div class="sister-card" onclick="login('${s.nombre}')">
                <span><strong style="color:var(--rosa-fuerte)">${i+1}.</strong> ${s.nombre}</span>
                <span style="font-weight:bold; color:var(--rosa-fuerte)">${s.totalPuntos} pts</span>
            </div>`;
    });
}

function login(n) {
    activeSister = sisters.find(s => s.nombre === n);
    document.getElementById('loginName').innerText = n;
    document.getElementById('passInput').value = "";
    document.getElementById('loginModal').classList.remove('hidden');
}

function checkPass() {
    if(document.getElementById('passInput').value == activeSister.password) {
        document.getElementById('loginModal').classList.add('hidden');
        showHist();
    } else { alert("Contraseña incorrecta, hermana."); }
}

function showHist() {
    const body = document.getElementById('histBody');
    document.getElementById('histTitle').innerText = activeSister.nombre;
    let h = `<table class="detail-table">`;
    [...activeSister.detalles].reverse().forEach(d => {
        const c = d.puntos >= 0 ? "#2e7d32" : "#c62828";
        h += `<tr><td>${new Date(d.fecha).toLocaleDateString()}</td><td>${d.motivo}</td><td style="color:${c}; font-weight:bold;">${d.puntos > 0 ? '+':''}${d.puntos}</td></tr>`;
    });
    body.innerHTML = h + `</table>`;
    document.getElementById('historyModal').classList.remove('hidden');
}

function openRules(t) {
    const isE = t === 'earn';
    document.getElementById('rulesTitle').innerText = isE ? "Cómo ganar puntos" : "Cómo perder puntos";
    document.getElementById('rulesTitle').style.color = isE ? "#2e7d32" : "#c62828";
    
    // Aquí puedes personalizar las reglas que se verán en los botones
    const r = isE ? 
        ["Saber parlamento (+50)", "Acto de servicio (+10)", "Destacar en trabajo (+5)"] : 
        ["Faltar sin aviso (-10)", "No preparar tarea (-5)", "Interrumpir (-10)"];
        
    document.getElementById('rulesList').innerHTML = r.map(i => `<p style="padding:10px; border-bottom:1px solid #eee; margin:0;">${i}</p>`).join('');
    document.getElementById('rulesModal').classList.remove('hidden');
}

init();
</script>
</body>
</html>
