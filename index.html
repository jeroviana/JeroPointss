<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jeropoints - Asamblea Jerovia</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --rosa-principal: #f8bbd0;
    --rosa-fuerte: #e91e63;
    --dorado: #dfaf37; --plata: #9e9e9e; --bronce: #cd7f32;
    --arcoiris-oficial: linear-gradient(90deg, #ffadad, #ffd6a5, #fdffb6, #caffbf, #9bf6ff, #a0c4ff, #bdb2ff);
  }

  body { 
    font-family: 'Montserrat', sans-serif; 
    background: #fffafb; 
    color: #444; 
    margin: 0; 
    min-height: 100vh; 
    padding-bottom: 120px;
  }
  
  header { 
    background: white; 
    padding: 25px; 
    text-align: center; 
    border-bottom: 5px solid transparent; 
    border-image: var(--arcoiris-oficial) 1;
    box-shadow: 0 4px 15px rgba(0,0,0,0.03);
  }
  
  h1 { font-family: 'Playfair Display', serif; font-size: 2.2rem; color: var(--rosa-fuerte); margin: 0; letter-spacing: 1px; }

  /* Podio Adaptable */
  .podium-container { 
    display: flex; justify-content: center; align-items: flex-end; 
    gap: 8px; margin: 30px auto; height: 240px; max-width: 500px; padding: 0 10px; 
  }
  .podium-step { flex: 1; display: flex; flex-direction: column; align-items: center; }
  .podium-bar { 
    width: 100%; border-radius: 12px 12px 0 0; display: flex; flex-direction: column; 
    justify-content: center; align-items: center; color: white; font-weight: bold; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
  }
  
  .step-1 { height: 140px; background: var(--dorado); order: 2; }
  .step-2 { height: 100px; background: var(--plata); order: 1; }
  .step-3 { height: 75px; background: var(--bronce); order: 3; }
  
  .podium-name { font-family: 'Playfair Display', serif; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; color: #333; text-align: center; }
  .avatar { 
    width: 55px; height: 55px; border-radius: 50%; background: white; 
    margin-bottom: -10px; z-index: 2; border: 3px solid white; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); object-fit: cover; 
  }

  /* Lista de Ranking */
  .ranking-list { max-width: 600px; margin: 0 auto; padding: 15px; }
  .sister-card { 
    background: white; margin-bottom: 10px; padding: 12px 20px; border-radius: 50px; 
    display: flex; justify-content: space-between; align-items: center; 
    cursor: pointer; transition: 0.3s; border: 1px solid #f0f0f0; 
  }
  .sister-card:hover { transform: scale(1.02); background: var(--rosa-principal); color: white; }

  /* BOTONES INFERIORES */
  .footer-btns {
    position: fixed; bottom: 20px; left: 0; width: 100%;
    display: flex; justify-content: center; gap: 10px;
    padding: 0 15px; box-sizing: border-box; z-index: 100;
  }
  .btn-fixed {
    flex: 1; max-width: 180px; padding: 12px 10px; border-radius: 25px;
    font-family: 'Montserrat', sans-serif; font-weight: 700; cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: none; font-size: 0.8rem;
    color: white; transition: 0.3s;
  }
  .btn-earn { background: #4caf50; }
  .btn-lose { background: #f44336; }

  /* Modales Generales */
  .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1000; }
  .modal-content { background: white; padding: 30px; border-radius: 25px; width: 85%; max-width: 350px; text-align: center; position: relative; }
  
  input { 
    width: 100%; max-width: 250px; padding: 12px; margin: 20px auto; 
    border: 2px solid var(--rosa-principal); border-radius: 12px; 
    text-align: center; font-size: 1.1rem; outline: none; display: block;
  }

  .btn-action { background: var(--rosa-fuerte); color: white; border: none; padding: 12px; border-radius: 20px; cursor: pointer; font-weight: 600; width: 100%; }
  .close-x { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; color: #ccc; cursor: pointer; }
  .detail-container { max-height: 350px; overflow-y: auto; margin-top: 15px; padding-right: 5px; }

  /* --- ESTILOS DE LA TIMELINE --- */
  .timeline { position: relative; padding-left: 30px; margin: 20px 0; text-align: left; }
  .timeline::before {
    content: ''; position: absolute; left: 10px; top: 0; width: 3px; height: 100%;
    background: var(--rosa-principal); border-radius: 5px;
  }
  .timeline-item { position: relative; margin-bottom: 25px; }
  .timeline-dot {
    position: absolute; left: -27px; top: 5px; width: 14px; height: 14px;
    background: white; border: 3px solid var(--rosa-fuerte); border-radius: 50%; z-index: 2;
  }
  .timeline-date { font-size: 0.7rem; font-weight: 700; color: #b3b3b3; margin-bottom: 5px; display: block; }
  .timeline-content {
    background: #fff; padding: 12px; border-radius: 15px; border: 1px solid #f0f0f0;
    box-shadow: 0 3px 10px rgba(0,0,0,0.02); display: flex; justify-content: space-between; align-items: center;
  }
  .timeline-motivo { font-size: 0.85rem; color: #555; font-weight: 500; }
  .timeline-pts { font-weight: 700; font-size: 0.95rem; }

  /* --- NUEVOS ESTILOS PARA LA LISTA DE REGLAS --- */
  .lista-reglas {
      list-style: none;
      padding: 0;
      margin: 0;
  }

  .item-regla {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9f9f9;
      margin-bottom: 12px;
      padding: 15px 15px;
      border-radius: 15px;
      transition: transform 0.2s;
      border: 1px solid #eee;
  }

  .item-regla:hover {
      transform: scale(1.02);
      background: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  .regla-texto {
      font-family: 'Montserrat', sans-serif;
      font-size: 0.85rem;
      color: #444;
      text-align: left;
      flex: 1;
      padding-right: 10px;
      line-height: 1.3;
      font-weight: 500;
  }

  /* Burbuja de puntaje positivo */
  .badge-pos {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 0.9rem;
      background: #e8f5e9;
      color: #2e7d32;
      padding: 6px 12px;
      border-radius: 10px;
      white-space: nowrap;
  }

  /* Burbuja de puntaje negativo */
  .badge-neg {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 0.9rem;
      background: #ffebee;
      color: #c62828;
      padding: 6px 12px;
      border-radius: 10px;
      white-space: nowrap;
  }

  .hidden { display: none !important; }
  .loading { text-align: center; padding: 100px; color: var(--rosa-fuerte); }
</style>
</head>
<body>

<header>
  <h1>Jeropoints</h1>
</header>

<main id="mainContent">
  <div class="loading">✨ Abriendo el Libro de Puntos... ✨</div>
</main>

<div class="footer-btns">
  <button class="btn-fixed btn-earn" onclick="openRules('earn')">Cómo ganar</button>
  <button class="btn-fixed btn-lose" onclick="openRules('lose')">Cómo perder</button>
</div>

<div id="rulesModal" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="close-x" onclick="document.getElementById('rulesModal').classList.add('hidden')">&times;</span>
    <h2 id="rulesTitle" style="font-family: 'Playfair Display', serif; margin-bottom: 20px;"></h2>
    <div id="rulesList" class="detail-container"></div>
  </div>
</div>

<div id="loginModal" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
  <div class="modal-content" onclick="event.stopPropagation()">
    <h2 id="loginName" style="font-family: 'Playfair Display', serif; color: var(--rosa-fuerte); margin:0;"></h2>
    <p style="color: #888; font-size: 0.85rem; margin-top: 10px;">Introduce tu contraseña</p>
    <input type="password" id="passInput">
    <button class="btn-action" onclick="checkPass()">Ver mis registros</button>
  </div>
</div>

<div id="historyModal" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
  <div class="modal-content" style="max-width: 450px;" onclick="event.stopPropagation()">
    <span class="close-x" onclick="document.getElementById('historyModal').classList.add('hidden')">&times;</span>
    <h2 id="histTitle" style="font-family: 'Playfair Display', serif; color: var(--rosa-fuerte); margin-bottom: 15px;"></h2>
    <div id="histBody" class="detail-container"></div>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwbnRBGyL2Uo84GD6yB9kRwCTCrMMyJk4P9YCxgWKQdXPxwsPe4TlWKN_3Y-dgeNL2yoA/exec";
let sisters = [];
let activeSister = null;

async function init() {
    try {
        const r = await fetch(SCRIPT_URL);
        sisters = await r.json();
        render();
    } catch(e) {
        document.getElementById('mainContent').innerHTML = "<p style='text-align:center; padding:50px;'>Error al conectar.</p>";
    }
}

function render() {
    const sorted = [...sisters].sort((a,b) => b.totalPuntos - a.totalPuntos);
    const main = document.getElementById('mainContent');
    main.innerHTML = `<div class="podium-container" id="pod"></div><div class="ranking-list" id="list"></div>`;
    
    const pod = document.getElementById('pod');
    [1,0,2].forEach(idx => {
        const s = sorted[idx];
        if(!s) return;
        pod.innerHTML += `
            <div class="podium-step">
                <div class="podium-name">${s.nombre}</div>
                <img src="${s.foto || 'https://ui-avatars.com/api/?name='+s.nombre+'&background=f8bbd0&color=fff'}" class="avatar">
                <div class="podium-bar step-${idx+1}"><span>${s.totalPuntos}</span><small>PTS</small></div>
            </div>`;
    });

    const list = document.getElementById('list');
    sorted.forEach((s, i) => {
        list.innerHTML += `
            <div class="sister-card" onclick="login('${s.nombre}')">
                <span><strong style="color:var(--rosa-fuerte)">${i+1}.</strong> ${s.nombre}</span>
                <span style="font-weight:bold; color:var(--rosa-fuerte)">${s.totalPuntos} pts</span>
            </div>`;
    });
}

function login(n) {
    activeSister = sisters.find(s => s.nombre === n);
    document.getElementById('loginName').innerText = n;
    document.getElementById('passInput').value = "";
    document.getElementById('loginModal').classList.remove('hidden');
    setTimeout(() => document.getElementById('passInput').focus(), 300);
}

function checkPass() {
    if(document.getElementById('passInput').value == activeSister.password) {
        document.getElementById('loginModal').classList.add('hidden');
        showHist();
    } else { alert("Contraseña incorrecta, hermana."); }
}

function showHist() {
    const body = document.getElementById('histBody');
    document.getElementById('histTitle').innerText = activeSister.nombre;
    
    let h = `<div class="timeline">`;
    
    [...activeSister.detalles].reverse().forEach(d => {
        const c = d.puntos >= 0 ? "#2e7d32" : "#c62828";
        const fechaSimple = new Date(d.fecha).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
        
        h += `
            <div class="timeline-item">
                <div class="timeline-dot"></div>
                <span class="timeline-date">${fechaSimple}</span>
                <div class="timeline-content">
                    <span class="timeline-motivo">${d.motivo}</span>
                    <span class="timeline-pts" style="color:${c}">${d.puntos > 0 ? '+':''}${d.puntos}</span>
                </div>
            </div>`;
    });
    
    h += `</div>`;
    
    if(activeSister.detalles.length === 0) {
        h = `<p style="padding:20px; color:#999;">Aún no hay registros en el libro.</p>`;
    }
    
    body.innerHTML = h;
    document.getElementById('historyModal').classList.remove('hidden');
}

// NUEVA LÓGICA PARA RENDERIZAR LAS REGLAS BONITAS
function openRules(t) {
    const isE = t === 'earn';
    document.getElementById('rulesTitle').innerText = isE ? "Cómo ganar puntos" : "Cómo perder puntos";
    document.getElementById('rulesTitle').style.color = isE ? "#2e7d32" : "#c62828";
    
    // Arrays de objetos en lugar de strings simples
    const earnRules = [
        { desc: "Saber parlamento de memoria en una publica (largo)", pts: "+ 50", colorBorde: "var(--dorado)" },
        { desc: "Participar de las dinámicas", pts: "+ 10", colorBorde: "var(--rosa-fuerte)" },
        { desc: "Destacar en trabajo", pts: "+ 5", colorBorde: "var(--rosa-principal)" }
    ];
    
    const loseRules = [
        { desc: "Ausencia injustificada", pts: "- 10" },
        { desc: "No participar de una dinámica obligatoria", pts: "- 5" },
        { desc: "Interrumpir", pts: "- 5" }
    ];
    
    const rulesToRender = isE ? earnRules : loseRules;
    const badgeClass = isE ? "badge-pos" : "badge-neg";
    
    let htmlContent = `<div class="lista-reglas">`;
    
    rulesToRender.forEach(rule => {
        // Solo aplica borde lateral de color si es para ganar puntos
        const borderStyle = isE ? `border-left: 5px solid ${rule.colorBorde};` : `border-left: 5px solid #c62828;`;
        
        htmlContent += `
            <div class="item-regla" style="${borderStyle}">
                <span class="regla-texto">${rule.desc}</span>
                <span class="${badgeClass}">${rule.pts}</span>
            </div>`;
    });
    
    htmlContent += `</div>`;
    
    document.getElementById('rulesList').innerHTML = htmlContent;
    document.getElementById('rulesModal').classList.remove('hidden');
}

init();
</script>
</body>
</html>
